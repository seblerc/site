<h2>ğŸ“¢ Duyuru Ekle</h2>
<form action="/admin/duyuru-ekle" method="POST">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <label>Duyuru BaÅŸlÄ±ÄŸÄ±:</label><br>
  <input type="text" name="baslik" required><br><br>

  <label>Duyuru Ä°Ã§eriÄŸi:</label><br>
  <textarea name="icerik" rows="4" required></textarea><br><br>

  <button type="submit">Duyuruyu YayÄ±nla</button>
</form>

<hr>

<h2>ğŸ›  Haber Ekle</h2>
<form action="/admin/haber-ekle" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <label>BaÅŸlÄ±k:</label><br>
  <input type="text" name="baslik" required><br><br>

  <label>Ä°Ã§erik:</label><br>
  <!-- CKEditor iÃ§eriÄŸi buraya aktarÄ±lacak -->
  <textarea id="editor" name="icerik" style="display: none;"></textarea>

  <label>Etiketler (virgÃ¼lle ayÄ±r):</label><br>
<input type="text" name="etiketler" placeholder="Ã¶rnek: palia, update, iÃ§erik"><br><br>

  <label>Kategori:</label><br>
  <select name="kategori_id" required>
    <% kategoriler.forEach(k => { %>
      <option value="<%= k.id %>"><%= k.isim %></option>
    <% }) %>
  </select><br><br>

  <label>GÃ¶rsel YÃ¼kle (Kapak):</label><br>
  <input type="file" name="resim" accept="image/*" required><br><br>

  <button type="submit">Haberi Ekle</button>
</form>

<!-- CKEditor -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
<script>
  let editorInstance;

  window.addEventListener("load", () => {
    ClassicEditor
      .create(document.querySelector('#editor'), {
        ckfinder: {
          uploadUrl: '/upload-image?_csrf=<%= csrfToken %>'
        }
      })
      .then(editor => {
        editorInstance = editor;

        document.querySelector('form[action="/admin/haber-ekle"]').addEventListener('submit', function (e) {
          const icerik = editor.getData().trim();

          if (!icerik) {
            alert("Ä°Ã§erik boÅŸ olamaz.");
            e.preventDefault();
            return;
          }

          document.querySelector('#editor').value = icerik;
        });
      })
      .catch(error => {
        console.error("CKEditor hatasÄ±:", error);
      });
  });
</script>

<script>
  setInterval(() => {
    fetch('/ping'); // ğŸ«¡ Oturumu diri tut
  }, 5 * 60 * 1000); // Her 5 dakikada bir
</script>

<a href="/">â† Anasayfaya DÃ¶n</a>